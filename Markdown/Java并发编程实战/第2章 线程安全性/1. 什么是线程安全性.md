下载资源 jar；`https://repo1.maven.org/maven2/org/lucee/jcip-annotations/1.0.0/jcip-annotations-1.0.0.jar`



先创建Java Web Module

`File` -> `New` -> `Module...`

`Java` -> `Next` -> `Finish`

选中`创建的 Model` -> 右键选择 `Add Framework Support...` -> 选择 `Web Application` -> `ok`



配置 Tomcat

`Run` -> `Edit Configurations...` -> `Add New Configuration` -> `Tomcat Server` -> `Local`



添加 Artifacts

刚刚添加的 `Tomcat 配置` -> `Deployment` -> `Deploy at the server starup` -> `Add` -> `Artifact...` -> `ok`



添加 tomcat 相关的 jar

`File` -> `Project Structure` -> `Modules` -> 选中`创建的 Model` -> `Dependencies` -> `Add` -> `Library...` -> `Application Server Libraries` -> `Tomcat ***` -> `Add Selected` -> `ok`



## 1. 一个无状态的 Servlet

Java 代码

```java
import javax.servlet.GenericServlet;
import javax.servlet.Servlet;
import javax.servlet.ServletConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import java.io.IOException;
import java.math.BigInteger;
import java.util.Arrays;

/**
 * @author osys
 */
public class StatelessFactories extends GenericServlet implements Servlet {

    @Override
    public void init(ServletConfig servletConfig) throws ServletException { }

    @Override
    public ServletConfig getServletConfig() { return null; }

    @Override
    public void service(ServletRequest servletRequest, ServletResponse servletResponse) throws ServletException, IOException {
        BigInteger i = extractFromRequest(servletRequest);
        BigInteger[] factories = factor(i);
        encodeIntoResponse(servletResponse, factories);

        System.out.println("Input：" + servletRequest.getParameter("demo"));
        System.out.println("i=" + i.toString());
        System.out.println("factories=" + Arrays.toString(factories));
    }

    @Override
    public String getServletInfo() { return null; }

    @Override
    public void destroy() { }

    void encodeIntoResponse(ServletResponse resp, BigInteger[] factors) { }

    BigInteger extractFromRequest(ServletRequest req) {
        return new BigInteger("7");
    }

    BigInteger[] factor(BigInteger i) {
        return new BigInteger[] { i };
    }

}
```



web.xml 配置：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">
    <!-- 配置和映射servlet -->
    <servlet>
        <!-- servlet注册的名字 -->
        <servlet-name>demoServlet</servlet-name>
        <!-- servlet的全类名-->
        <servlet-class>StatelessFactories</servlet-class>
    </servlet>

    <servlet-mapping>
        <!-- 需要和某一个servlet节点的servlet子节点的文本节点一致 -->
        <servlet-name>demoServlet</servlet-name>
        <!-- 映射具体 的访问路径: /  代表当前web应用的根目录 -->
        <url-pattern>/Demo</url-pattern>
    </servlet-mapping>
</web-app>
```



index.jsp 代码：

```jsp
<%--
  Created by IntelliJ IDEA.
  User: osys
  Date: 2022/3/25
  Time: 16:24
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
    <head>
        <title>测试</title>
    </head>
    <body>
        <form name="f1" id="f1" action="${pageContext.request.contextPath}/Demo" method="post">
            <table>
                <tr>
                    <td>创建数组:</td>
                    <td><label for="demo"></label><input type="text" name="demo" id="demo"></td>
                </tr>
                <tr>
                    <td colspan="2"><input type="submit"></td>
                </tr>
            </table>
        </form>
    </body>
</html>
```



运行 Tomcat，访问 `http://localhost:8080/`

随意输入 `1234` 并提交，页面跳转到 `http://localhost:8080/Demo`

控制台 output：

```
Input:1234
i=7
factories=[7]
```



访问 `StatelessFactories` 的线程不会影响另一个访问同一个 `StatelessFactories` 的线程的计算结果，因为两个线程并没有共享状态。

由于线程访问无状态对象的行为并不会影响其他线程中操作的正确性，因此无状态对象是线程安全的。



说明：

* `有状态对象`(Stateful Bean)：有数据存储功能。是有实例变量的对象，可以保存数据，是 `非线程安全` 的。在不同方法调用间不保留任何状态。
* `无状态对象`(Stateless Bean)：一次操作，不能保存数据。是没有实例变量的对象，不能保存数据，是不变类，是 `线程安全` 的。